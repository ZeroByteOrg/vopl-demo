#!/bin/php
<?php

// test script to test the LUT portion of the log2() routine

$lut = array (
0,  1,  3,  4,  6,  7,  9,  10, 11, 13, 14, 16, 17, 18, 20, 21,
22, 24, 25, 26, 28, 29, 30, 32, 33, 34, 36, 37, 38, 40, 41, 42,
44, 45, 46, 47, 49, 50, 51, 52, 54, 55, 56, 57, 59, 60, 61, 62,
63, 65, 66, 67, 68, 69, 71, 72, 73, 74, 75, 77, 78, 79, 80, 81,
82, 84, 85, 86, 87, 88, 89, 90, 92, 93, 94, 95, 96, 97, 98, 99,
100,102,103,104,105,106,107,108,109,110,111,112,113,114,116,117,
118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,
134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,
150,151,152,153,154,155,155,156,157,158,159,160,161,162,163,164,
165,166,167,168,169,169,170,171,172,173,174,175,176,177,178,178,
179,180,181,182,183,184,185,185,186,187,188,189,190,191,192,192,
193,194,195,196,197,198,198,199,200,201,202,203,203,204,205,206,
207,208,208,209,210,211,212,212,213,214,215,216,216,217,218,219,
220,220,221,222,223,224,224,225,226,227,228,228,229,230,231,231,
232,233,234,234,235,236,237,238,238,239,240,241,241,242,243,244,
244,245,246,247,247,248,249,249,250,251,252,252,253,254,255,255
);

/*
So if the number is less than 256, shift left until >= 256. If the number >= 512, shift right 1.
[3:00 PM]
Then use the low 8 bits as the index into the lookup table above.
*/
function bin($v) {
  $s="";
  for($x=7;$x>=0;$x--)
   if($v&(1<<$x)) $s=$s."1" ; else $s=$s."0";
  return($s);
}

if(isset($argv[1]))
  define("USEME",$argv[1]);
else define("USEME",72);

$val = USEME;

for($i=7;$i>=0;$i--) {
  $val = $val<<1;
  if ($val >= 256) { $val &= 0xff; break; }
}
print "\n\nComputing log2($val)\n";
//bin($i); print"."; bin($lut2[$val]) ; print "\n";
printf("%d.%s (%d) lut[%d]\n",$i,bin($lut[$val]),$lut[$val],$val);
printf("%1.6f (from LUT)\n",($lut[$val]/256)+$i);
printf("%1.6f (computed)\n",log(USEME,2));
?>
